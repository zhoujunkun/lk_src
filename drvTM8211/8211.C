//-----------------------------------------------------
//测试项目:16位数字模拟转换器TM8211芯片测试
//测试内容:输出相位平移的正弦波
//测试单片机:STC12C5608AD
//晶振:36MHZ

//-----------------------------------------------------
#include<reg52.H>
#include<intrins.h>
//-----------------------------------------------------
#define uint unsigned int 
#define uchar unsigned char 
//-----------------------------------------------------
sbit BCK=P2^1;
sbit WS=P2^0;
sbit DIN=P1^7;

//======================================================
int *intR;
int *intL;

//======================================================
int code tab16[]={

0, 		   //*32767
1029, 
2057,
3084,
4107,
5126, 
6140, 
7148, 
8149, 
9142, 
10126, 
11099, 
12062, 
13013, 
13952, 
14876, 
15786, 
16680, 
17557, 
18418, 
19260, 
20083, 
20886, 
21669, 
22431,
23170, 
23886, 
24579, 
25247, 
25891, 
26509, 
27101, 
27666, 
28204, 
28714, 
29196, 
29648, 
30072, 
30466, 
30830, 
31163, 
31466, 
31738, 
31978, 
32187, 
32364, 
32509, 
32622, 
32702, 
32751, 
32767, 
32751, 
32702, 
32622, 
32509, 
32364, 
32187,
31978,
31738, 
31466, 
31163, 
30830, 
30466, 
30072, 
29648, 
29196, 
28714, 
28204, 
27666, 
27101, 
26509, 
25891, 
25247, 
24579, 
23886, 
23170, 
22431, 
21669, 
20886, 
20083, 
19260, 
18418, 
17557, 
16680, 
15786, 
14876, 
13952, 
13013, 
12062, 
11099, 
10126, 
9142,
8149, 
7148, 
6140, 
5126, 
4107, 
3084, 
2057, 
1029, 
0 	,
-1029, 
-2057, 
-3084, 
-4107, 
-5126, 
-6140, 
-7148, 
-8149, 
-9142, 
-10126, 
-11099, 
-12062, 
-13013, 
-13952, 
-14876, 
-15786, 
-16680, 
-17557, 
-18418, 
-19260, 
-20083, 
-20886, 
-21669, 
-22431, 
-23170, 
-23886, 
-24579, 
-25247, 
-25891, 
-26509, 
-27101, 
-27666, 
-28204, 
-28714, 
-29196, 
-29648, 
-30072, 
-30466, 
-30830, 
-31163, 
-31466, 
-31738, 
-31978, 
-32187, 
-32364, 
-32509, 
-32622, 
-32702, 
-32751, 
-32767, 
-32751, 
-32702, 
-32622,
-32509, 
-32364, 
-32187, 
-31978, 
-31738, 
-31466, 
-31163, 
-30830, 
-30466, 
-30072, 
-29648, 
-29196, 
-28714, 
-28204, 
-27666, 
-27101, 
-26509, 
-25891, 
-25247, 
-24579, 
-23886, 
-23170, 
-22431, 
-21669, 
-20886, 
-20083, 
-19260, 
-18418, 
-17557, 
-16680, 
-15786, 
-14876, 
-13952, 
-13013, 
-12062, 
-11099, 
-10126, 
-9142, 
-8149, 
-7148, 
-6140, 
-5126, 
-4107, 
-3084, 
-2057, 
-1029 	
};
//======================================================
//     	写入16位数据
 void write_16bit(uint temp)
{
	uchar i;
	DIN=0;
	BCK=0;
	for(i=0;i<16;i++)
	{
		 BCK=0;
		 if(temp&0x8000)
		   DIN=1;
		 else
		   DIN=0;
		 BCK=1;
		 temp<<=1;	 
	}
}

//------------------------------------------------------------------
void delay(uint z)		   //1us延时子程序
{
	uint x,y;
	for(x=z;x>0;x--)
		for(y=112;y>0;y--);
}
//=======================================================
void delay1us(uint z)
{
	while(z--);
}
//=======================================================

void main()
{	
	int j1,j2;
    uchar phase=0;
	WS=0;

	while(1)
	{
		intL=tab16;
		j2=0;
		for(j1=0;j1<200;j1++)
		{		
		        intL=tab16+j1;
		        WS=1;					 //LCH输出
				write_16bit((*intL));  
				
				j2=(j1+phase)%200;
			
				intR=tab16+j2;
				WS=0;					 //RCH输出
				write_16bit(*(intR));
		
		}
	  phase++;
	  if(phase>=200)
	  phase=0;
	
	}
}

